{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Прогноз погоды</title>
    <link rel="stylesheet" href="{% static 'weather/styles.css' %}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
    >

</head>
<body>
    <div class="form-container">
        <h1>Узнать погоду</h1>
        <form method="get" action="">
            <label for="city">Город:</label>
            <div class="input-button-wrapper">
                <div class="autocomplete-wrapper">
                    <input
                        type="text"
                        name="city"
                        id="city-input"
                        placeholder="Введите город"
                        autocomplete="off"
                        value="{{ request.GET.city|default:'' }}"
                    />
                    <ul id="suggestions"></ul>
                </div>
                <button type="submit" aria-label="Узнать погоду">
                    <!-- SVG иконка лупы -->
                    <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" fill="white" viewBox="0 0 24 24">
                        <path d="M10 18a8 8 0 1 1 5.293-2.707l4.707 4.707-1.414 1.414-4.707-4.707A7.963 7.963 0 0 1 10 18zm0-14a6 6 0 1 0 0 12 6 6 0 0 0 0-12z"/>
                    </svg>
                </button>
            </div>
        </form>
        {% if last_cities %}
            <div class="mt-3">
                <h5>Недавние города:</h5>
                {% for item in last_cities %}
                    <a href="/?city={{ item.city_name }}" class="btn btn-outline-primary btn-sm m-1">
                    {{ item.city_name }}
                    </a>
                {% empty %}
                    <p class="text-muted">История пуста</p>
                {% endfor %}
                </div>
        {% endif %}


        {% if weather %}
        <div class="weather-block">
            <h2>Погода в {{ city }}</h2>
            <p>Температура воздуха: {{ weather.temperature }}°C</p>
            <p>Текущие погодные условия: {{ weather.weathercode|default:'—' }}</p>
            <p>Скорость ветра: {{ weather.windspeed }} км/ч</p>
        </div>

        {% if weather_forecast %}
            {{ weather_forecast.dates|json_script:"dates-data" }}
            {{ weather_forecast.temperatures|json_script:"temps-data" }}
            {{ weather_forecast.icons|json_script:"icons-data" }}
        {% endif %}

        <h2>Прогноз на 7 дней</h2>
        <canvas id="tempChart" style="max-width: 100%; height: 400px; margin-top: 2rem;"></canvas>

        {% elif error %}
        <div class="weather-block error-message">
            {{ error }}
        </div>
        {% endif %}
    </div>

    <script src="{% static 'weather/scripts.js' %}"></script>
</body>
</html>
